{"pageProps":{"toc":"[{\"url\":\"#\",\"text\":\"概览\",\"depth\":2},{\"url\":\"#reference\",\"depth\":2,\"text\":\"参考 \"},{\"url\":\"#usetransition\",\"depth\":3,\"text\":[[\"$r\",\"code\",null,{\"children\":\"useTransition()\"}],\" \"]},{\"url\":\"#starttransition\",\"depth\":3,\"text\":[[\"$r\",\"code\",null,{\"children\":\"startTransition\"}],\" 函数 \"]},{\"url\":\"#usage\",\"depth\":2,\"text\":\"用法 \"},{\"url\":\"#marking-a-state-update-as-a-non-blocking-transition\",\"depth\":3,\"text\":\"将状态更新标记为非阻塞的 transition \"},{\"url\":\"#updating-the-parent-component-in-a-transition\",\"depth\":3,\"text\":\"在 transition 中更新父组件 \"},{\"url\":\"#displaying-a-pending-visual-state-during-the-transition\",\"depth\":3,\"text\":\"在 transition 期间显示待处理的视觉状态 \"},{\"url\":\"#preventing-unwanted-loading-indicators\",\"depth\":3,\"text\":\"避免不必要的加载指示器 \"},{\"url\":\"#building-a-suspense-enabled-router\",\"depth\":3,\"text\":\"构建一个Suspense-enabled 的路由 \"},{\"url\":\"#displaying-an-error-to-users-with-error-boundary\",\"depth\":3,\"text\":\"Displaying an error to users with an error boundary \"},{\"url\":\"#troubleshooting\",\"depth\":2,\"text\":\"Troubleshooting \"},{\"url\":\"#updating-an-input-in-a-transition-doesnt-work\",\"depth\":3,\"text\":\"在 transition 中无法更新输入框内容 \"},{\"url\":\"#react-doesnt-treat-my-state-update-as-a-transition\",\"depth\":3,\"text\":\"React 没有将状态更新视为 transition \"},{\"url\":\"#i-want-to-call-usetransition-from-outside-a-component\",\"depth\":3,\"text\":[\"我想在组件外部调用 \",[\"$r\",\"code\",null,{\"children\":\"useTransition\"}],\" \"]},{\"url\":\"#the-function-i-pass-to-starttransition-executes-immediately\",\"depth\":3,\"text\":[\"我传递给 \",[\"$r\",\"code\",null,{\"children\":\"startTransition\"}],\" 的函数会立即执行 \"]}]","content":"[[\"$r\",\"MaxWidth\",\"68\",{\"children\":[[\"$r\",\"Intro\",null,{\"children\":[[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"useTransition\"}],\" 是一个帮助你在不阻塞 UI 的情况下更新状态的 React Hook。\"]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"const [isPending, startTransition] = useTransition()\\n\"}]}]]}],\"\\n\",[\"$r\",\"InlineToc\",null,{}],\"\\n\",[\"$r\",\"hr\",null,{}],\"\\n\",[\"$r\",\"h2\",null,{\"id\":\"reference\",\"children\":\"参考 \"}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"usetransition\",\"children\":[[\"$r\",\"code\",null,{\"children\":\"useTransition()\"}],\" \"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在组件顶层调用 \",[\"$r\",\"code\",null,{\"children\":\"useTransition\"}],\"，将某些状态更新标记为 transition。\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"import { useTransition } from 'react';\\n\\nfunction TabContainer() {\\n  const [isPending, startTransition] = useTransition();\\n  // ……\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"a\",null,{\"href\":\"#usage\",\"children\":\"参见下方更多示例\"}],\"。\"]}],\"\\n\",[\"$r\",\"h4\",null,{\"id\":\"parameters\",\"children\":\"参数 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"useTransition\"}],\" 不需要任何参数。\"]}],\"\\n\",[\"$r\",\"h4\",null,{\"id\":\"returns\",\"children\":\"返回值 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"useTransition\"}],\" 返回一个由两个元素组成的数组：\"]}],\"\\n\",[\"$r\",\"ol\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"isPending\"}],\"，告诉你是否存在待处理的 transition。\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"a\",null,{\"href\":\"#starttransition\",\"children\":[[\"$r\",\"code\",null,{\"children\":\"startTransition\"}],\" 函数\"]}],\"，你可以使用此方法将状态更新标记为 transition。\"]}],\"\\n\"]}],\"\\n\",[\"$r\",\"hr\",null,{}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"starttransition\",\"children\":[[\"$r\",\"code\",null,{\"children\":\"startTransition\"}],\" 函数 \"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"useTransition\"}],\" 返回的 \",[\"$r\",\"code\",null,{\"children\":\"startTransition\"}],\" 函数允许你将状态更新标记为 transition。\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{6,8}\",\"children\":\"function TabContainer() {\\n  const [isPending, startTransition] = useTransition();\\n  const [tab, setTab] = useState('about');\\n\\n  function selectTab(nextTab) {\\n    startTransition(() => {\\n      setTab(nextTab);\\n    });\\n  }\\n  // ……\\n}\\n\"}]}],\"\\n\",[\"$r\",\"h4\",null,{\"id\":\"starttransition-parameters\",\"children\":\"参数 \"}],\"\\n\",[\"$r\",\"ul\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"作用域（scope）：一个通过调用一个或多个 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/useState#setstate\",\"children\":[[\"$r\",\"code\",null,{\"children\":\"set\"}],\" 函数\"]}],\" 更新状态的函数。React 会立即不带参数地调用此函数，并将在 \",[\"$r\",\"code\",null,{\"children\":\"scope\"}],\" 调用期间将所有同步安排的状态更新标记为 transition。它们将是非阻塞的，并且 \",[\"$r\",\"a\",null,{\"href\":\"#preventing-unwanted-loading-indicators\",\"children\":\"不会显示不想要的加载指示器\"}],\"。\"]}],\"\\n\"]}],\"\\n\",[\"$r\",\"h4\",null,{\"id\":\"starttransition-returns\",\"children\":\"返回值 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"startTransition\"}],\" 不返回任何值。\"]}],\"\\n\",[\"$r\",\"h4\",null,{\"id\":\"starttransition-caveats\",\"children\":\"注意 \"}],\"\\n\",[\"$r\",\"ul\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"useTransition\"}],\" 是一个 Hook，因此只能在组件或自定义 Hook 内部调用。如果需要在其他地方启动 transition（例如从数据库），请调用独立的 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/startTransition\",\"children\":[\"$r\",\"code\",null,{\"children\":\"startTransition\"}]}],\" 函数。\"]}],\"\\n\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"只有在可以访问该状态的 \",[\"$r\",\"code\",null,{\"children\":\"set\"}],\" 函数时，才能将其对应的状态更新包装为 transition。如果你想启用 transition 以响应某个 prop 或自定义 Hook 值，请尝试使用 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/useDeferredValue\",\"children\":[\"$r\",\"code\",null,{\"children\":\"useDeferredValue\"}]}],\"。\"]}],\"\\n\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"传递给 \",[\"$r\",\"code\",null,{\"children\":\"startTransition\"}],\" 的函数必须是同步的。React 会立即执行此函数，并将在其执行期间发生的所有状态更新标记为 transition。如果在其执行期间，尝试稍后执行状态更新（例如在一个定时器中执行状态更新），这些状态更新不会被标记为 transition。\"]}],\"\\n\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"\\n\",[\"$r\",\"p\",null,{\"children\":\"标记为 transition 的状态更新将被其他状态更新打断。例如在 transition 中更新图表组件，并在图表组件仍在重新渲染时继续在输入框中输入，React 将首先处理输入框的更新，之后再重新启动对图表组件的渲染工作。\"}],\"\\n\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"\\n\",[\"$r\",\"p\",null,{\"children\":\"transition 更新不能用于控制文本输入。\"}],\"\\n\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"\\n\",[\"$r\",\"p\",null,{\"children\":\"目前，React 会批处理多个同时进行的 transition。这是一个限制，可能会在未来版本中删除。\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$r\",\"hr\",null,{}],\"\\n\",[\"$r\",\"h2\",null,{\"id\":\"usage\",\"children\":\"用法 \"}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"marking-a-state-update-as-a-non-blocking-transition\",\"children\":\"将状态更新标记为非阻塞的 transition \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在组件的顶层调用 \",[\"$r\",\"code\",null,{\"children\":\"useTransition\"}],\" 以将状态更新标记为非阻塞的 transition。\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"[[1, 4, \\\"isPending\\\"], [2, 4, \\\"startTransition\\\"]]\",\"children\":\"import { useState, useTransition } from 'react';\\n\\nfunction TabContainer() {\\n  const [isPending, startTransition] = useTransition();\\n  // ……\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"useTransition\"}],\" 返回一个由两个元素组成的数组：\"]}],\"\\n\",[\"$r\",\"ol\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"CodeStep\",null,{\"step\":1,\"children\":[\"$r\",\"code\",null,{\"children\":\"isPending\"}]}],\"，告诉你是否存在待处理的 transition。\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"CodeStep\",null,{\"step\":2,\"children\":[[\"$r\",\"code\",null,{\"children\":\"startTransition\"}],\" 函数\"]}],\"，你可以使用此方法将状态更新标记为 transition。\"]}],\"\\n\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"你可以按照以下方式将状态更新标记为 transition：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{6,8}\",\"children\":\"function TabContainer() {\\n  const [isPending, startTransition] = useTransition();\\n  const [tab, setTab] = useState('about');\\n\\n  function selectTab(nextTab) {\\n    startTransition(() => {\\n      setTab(nextTab);\\n    });\\n  }\\n  // ……\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"transition 可以使用户界面的更新在慢速设备上仍保持响应性。\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"通过 transition，UI 仍将在重新渲染过程中保持响应性。例如用户点击一个选项卡，但改变了主意并点击另一个选项卡，他们可以在不等待第一个重新渲染完成的情况下完成操作。\"}],\"\\n\"]}],[\"$r\",\"Recipes\",null,{\"titleText\":\"使用 useTransition 与常规状态更新的区别\",\"titleId\":\"examples\",\"children\":[[\"$r\",\"h4\",null,{\"id\":\"updating-the-current-tab-in-a-transition\",\"children\":\"在 transition 中更新当前选项卡 \"}],[\"$r\",\"p\",null,{\"children\":[\"在此示例中，“文章”选项卡被 \",[\"$r\",\"strong\",null,{\"children\":\"人为地减慢\"}],\"，以便至少需要一秒钟才能渲染。\"]}],[\"$r\",\"p\",null,{\"children\":\"点击“Posts”，然后立即点击“Contact”。请注意，这会中断“Posts”的缓慢渲染，而“联系人”选项卡将会立即显示。因为此状态更新被标记为 transition，所以缓慢的重新渲染不会冻结用户界面。\"}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"import { useState, useTransition } from 'react';\\nimport TabButton from './TabButton.js';\\nimport AboutTab from './AboutTab.js';\\nimport PostsTab from './PostsTab.js';\\nimport ContactTab from './ContactTab.js';\\n\\nexport default function TabContainer() {\\n  const [isPending, startTransition] = useTransition();\\n  const [tab, setTab] = useState('about');\\n\\n  function selectTab(nextTab) {\\n    startTransition(() => {\\n      setTab(nextTab);\\n    });\\n  }\\n\\n  return (\\n    <>\\n      <TabButton\\n        isActive={tab === 'about'}\\n        onClick={() => selectTab('about')}\\n      >\\n        About\\n      </TabButton>\\n      <TabButton\\n        isActive={tab === 'posts'}\\n        onClick={() => selectTab('posts')}\\n      >\\n        Posts (slow)\\n      </TabButton>\\n      <TabButton\\n        isActive={tab === 'contact'}\\n        onClick={() => selectTab('contact')}\\n      >\\n        Contact\\n      </TabButton>\\n      <hr />\\n      {tab === 'about' && <AboutTab />}\\n      {tab === 'posts' && <PostsTab />}\\n      {tab === 'contact' && <ContactTab />}\\n    </>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/TabButton.js\",\"children\":\"import { useTransition } from 'react';\\n\\nexport default function TabButton({ children, isActive, onClick }) {\\n  if (isActive) {\\n    return <b>{children}</b>\\n  }\\n  return (\\n    <button onClick={() => {\\n      onClick();\\n    }}>\\n      {children}\\n    </button>\\n  )\\n}\\n\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/AboutTab.js\",\"children\":\"export default function AboutTab() {\\n  return (\\n    <p>Welcome to my profile!</p>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/PostsTab.js\",\"children\":\"import { memo } from 'react';\\n\\nconst PostsTab = memo(function PostsTab() {\\n  // 打印一次。真正变慢的地方在 SlowPost 内。\\n  console.log('[ARTIFICIALLY SLOW] Rendering 500 <SlowPost />');\\n\\n  let items = [];\\n  for (let i = 0; i < 500; i++) {\\n    items.push(<SlowPost key={i} index={i} />);\\n  }\\n  return (\\n    <ul className=\\\"items\\\">\\n      {items}\\n    </ul>\\n  );\\n});\\n\\nfunction SlowPost({ index }) {\\n  let startTime = performance.now();\\n  while (performance.now() - startTime < 1) {\\n    // 每个 item 都等待 1 毫秒以模拟极慢的代码。\\n  }\\n\\n  return (\\n    <li className=\\\"item\\\">\\n      Post #{index + 1}\\n    </li>\\n  );\\n}\\n\\nexport default PostsTab;\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/ContactTab.js\",\"children\":\"export default function ContactTab() {\\n  return (\\n    <>\\n      <p>\\n        You can find me online here:\\n      </p>\\n      <ul>\\n        <li>admin@mysite.com</li>\\n        <li>+123456789</li>\\n      </ul>\\n    </>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"button { margin-right: 10px }\\nb { display: inline-block; margin-right: 10px; }\\n\"}]}]]}],[\"$r\",\"Solution\",null,{}],[\"$r\",\"h4\",null,{\"id\":\"updating-the-current-tab-without-a-transition\",\"children\":\"在不使用 transition 的情况下更新当前选项卡 \"}],[\"$r\",\"p\",null,{\"children\":[\"在此示例中，“Posts”选项卡同样被 \",[\"$r\",\"strong\",null,{\"children\":\"人为地减慢\"}],\"，以便至少需要一秒钟才能渲染。与之前的示例不同，这个状态更新 \",[\"$r\",\"strong\",null,{\"children\":\"没有使用 transition\"}],\"。\"]}],[\"$r\",\"p\",null,{\"children\":[\"点击“Posts”，然后立即点击“Contact”。请注意，应用程序在渲染减速选项卡时会冻结，UI 将变得无响应。由于这个状态更新 \",[\"$r\",\"strong\",null,{\"children\":\"没有使用 transition\"}],\"，所以慢速的重新渲染会冻结用户界面。\"]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"import { useState } from 'react';\\nimport TabButton from './TabButton.js';\\nimport AboutTab from './AboutTab.js';\\nimport PostsTab from './PostsTab.js';\\nimport ContactTab from './ContactTab.js';\\n\\nexport default function TabContainer() {\\n  const [tab, setTab] = useState('about');\\n\\n  function selectTab(nextTab) {\\n    setTab(nextTab);\\n  }\\n\\n  return (\\n    <>\\n      <TabButton\\n        isActive={tab === 'about'}\\n        onClick={() => selectTab('about')}\\n      >\\n        About\\n      </TabButton>\\n      <TabButton\\n        isActive={tab === 'posts'}\\n        onClick={() => selectTab('posts')}\\n      >\\n        Posts (slow)\\n      </TabButton>\\n      <TabButton\\n        isActive={tab === 'contact'}\\n        onClick={() => selectTab('contact')}\\n      >\\n        Contact\\n      </TabButton>\\n      <hr />\\n      {tab === 'about' && <AboutTab />}\\n      {tab === 'posts' && <PostsTab />}\\n      {tab === 'contact' && <ContactTab />}\\n    </>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/TabButton.js\",\"children\":\"import { useTransition } from 'react';\\n\\nexport default function TabButton({ children, isActive, onClick }) {\\n  if (isActive) {\\n    return <b>{children}</b>\\n  }\\n  return (\\n    <button onClick={() => {\\n      onClick();\\n    }}>\\n      {children}\\n    </button>\\n  )\\n}\\n\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/AboutTab.js\",\"children\":\"export default function AboutTab() {\\n  return (\\n    <p>Welcome to my profile!</p>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/PostsTab.js\",\"children\":\"import { memo } from 'react';\\n\\nconst PostsTab = memo(function PostsTab() {\\n  // 打印一次。真正变慢的地方在 SlowPost 内。\\n  console.log('[ARTIFICIALLY SLOW] Rendering 500 <SlowPost />');\\n\\n  let items = [];\\n  for (let i = 0; i < 500; i++) {\\n    items.push(<SlowPost key={i} index={i} />);\\n  }\\n  return (\\n    <ul className=\\\"items\\\">\\n      {items}\\n    </ul>\\n  );\\n});\\n\\nfunction SlowPost({ index }) {\\n  let startTime = performance.now();\\n  while (performance.now() - startTime < 1) {\\n    // 每个 item 都等待 1 毫秒以模拟极慢的代码。\\n  }\\n\\n  return (\\n    <li className=\\\"item\\\">\\n      Post #{index + 1}\\n    </li>\\n  );\\n}\\n\\nexport default PostsTab;\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/ContactTab.js\",\"children\":\"export default function ContactTab() {\\n  return (\\n    <>\\n      <p>\\n        You can find me online here:\\n      </p>\\n      <ul>\\n        <li>admin@mysite.com</li>\\n        <li>+123456789</li>\\n      </ul>\\n    </>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"button { margin-right: 10px }\\nb { display: inline-block; margin-right: 10px; }\\n\"}]}]]}],[\"$r\",\"Solution\",null,{}]]}],[\"$r\",\"MaxWidth\",\"80\",{\"children\":[\"\\n\",[\"$r\",\"hr\",null,{}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"updating-the-parent-component-in-a-transition\",\"children\":\"在 transition 中更新父组件 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"你也可以通过调用 \",[\"$r\",\"code\",null,{\"children\":\"useTransition\"}],\" 以更新父组件状态。例如，\",[\"$r\",\"code\",null,{\"children\":\"TabButton\"}],\" 组件在 transition 中包装了 \",[\"$r\",\"code\",null,{\"children\":\"onClick\"}],\" 逻辑：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{8-10}\",\"children\":\"export default function TabButton({ children, isActive, onClick }) {\\n  const [isPending, startTransition] = useTransition();\\n  if (isActive) {\\n    return <b>{children}</b>\\n  }\\n  return (\\n    <button onClick={() => {\\n      startTransition(() => {\\n        onClick();\\n      });\\n    }}>\\n      {children}\\n    </button>\\n  );\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"由于父组件的状态更新在 \",[\"$r\",\"code\",null,{\"children\":\"onClick\"}],\" 事件处理程序内，所以该状态更新会被标记为 transition。这就是为什么可以在点击“Posts”后立即点击“Contact”。由于更新选定选项卡被标记为了 transition，因此它不会阻止用户交互。\"]}],\"\\n\"]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"import { useState } from 'react';\\nimport TabButton from './TabButton.js';\\nimport AboutTab from './AboutTab.js';\\nimport PostsTab from './PostsTab.js';\\nimport ContactTab from './ContactTab.js';\\n\\nexport default function TabContainer() {\\n  const [tab, setTab] = useState('about');\\n  return (\\n    <>\\n      <TabButton\\n        isActive={tab === 'about'}\\n        onClick={() => setTab('about')}\\n      >\\n        About\\n      </TabButton>\\n      <TabButton\\n        isActive={tab === 'posts'}\\n        onClick={() => setTab('posts')}\\n      >\\n        Posts (slow)\\n      </TabButton>\\n      <TabButton\\n        isActive={tab === 'contact'}\\n        onClick={() => setTab('contact')}\\n      >\\n        Contact\\n      </TabButton>\\n      <hr />\\n      {tab === 'about' && <AboutTab />}\\n      {tab === 'posts' && <PostsTab />}\\n      {tab === 'contact' && <ContactTab />}\\n    </>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/TabButton.js active\",\"children\":\"import { useTransition } from 'react';\\n\\nexport default function TabButton({ children, isActive, onClick }) {\\n  const [isPending, startTransition] = useTransition();\\n  if (isActive) {\\n    return <b>{children}</b>\\n  }\\n  return (\\n    <button onClick={() => {\\n      startTransition(() => {\\n        onClick();\\n      });\\n    }}>\\n      {children}\\n    </button>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/AboutTab.js\",\"children\":\"export default function AboutTab() {\\n  return (\\n    <p>Welcome to my profile!</p>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/PostsTab.js\",\"children\":\"import { memo } from 'react';\\n\\nconst PostsTab = memo(function PostsTab() {\\n  // 打印一次。真正变慢的地方在 SlowPost 内。\\n  console.log('[ARTIFICIALLY SLOW] Rendering 500 <SlowPost />');\\n\\n  let items = [];\\n  for (let i = 0; i < 500; i++) {\\n    items.push(<SlowPost key={i} index={i} />);\\n  }\\n  return (\\n    <ul className=\\\"items\\\">\\n      {items}\\n    </ul>\\n  );\\n});\\n\\nfunction SlowPost({ index }) {\\n  let startTime = performance.now();\\n  while (performance.now() - startTime < 1) {\\n    // 每个 item 都等待 1 毫秒以模拟极慢的代码。\\n  }\\n\\n  return (\\n    <li className=\\\"item\\\">\\n      Post #{index + 1}\\n    </li>\\n  );\\n}\\n\\nexport default PostsTab;\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/ContactTab.js\",\"children\":\"export default function ContactTab() {\\n  return (\\n    <>\\n      <p>\\n        You can find me online here:\\n      </p>\\n      <ul>\\n        <li>admin@mysite.com</li>\\n        <li>+123456789</li>\\n      </ul>\\n    </>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"button { margin-right: 10px }\\nb { display: inline-block; margin-right: 10px; }\\n\"}]}]]}],[\"$r\",\"MaxWidth\",\"92\",{\"children\":[\"\\n\",[\"$r\",\"hr\",null,{}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"displaying-a-pending-visual-state-during-the-transition\",\"children\":\"在 transition 期间显示待处理的视觉状态 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"你可以使用 \",[\"$r\",\"code\",null,{\"children\":\"useTransition\"}],\" 返回的 \",[\"$r\",\"code\",null,{\"children\":\"isPending\"}],\" 布尔值来向用户表明当前处于 transition 中。例如，选项卡按钮可以有一个特殊的“pending”视觉状态：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{4-6}\",\"children\":\"function TabButton({ children, isActive, onClick }) {\\n  const [isPending, startTransition] = useTransition();\\n  // ...\\n  if (isPending) {\\n    return <b className=\\\"pending\\\">{children}</b>;\\n  }\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"请注意，现在点击“Posts”感觉更加灵敏，因为选项卡按钮本身立即更新了：\"}],\"\\n\"]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"import { useState } from 'react';\\nimport TabButton from './TabButton.js';\\nimport AboutTab from './AboutTab.js';\\nimport PostsTab from './PostsTab.js';\\nimport ContactTab from './ContactTab.js';\\n\\nexport default function TabContainer() {\\n  const [tab, setTab] = useState('about');\\n  return (\\n    <>\\n      <TabButton\\n        isActive={tab === 'about'}\\n        onClick={() => setTab('about')}\\n      >\\n        About\\n      </TabButton>\\n      <TabButton\\n        isActive={tab === 'posts'}\\n        onClick={() => setTab('posts')}\\n      >\\n        Posts (slow)\\n      </TabButton>\\n      <TabButton\\n        isActive={tab === 'contact'}\\n        onClick={() => setTab('contact')}\\n      >\\n        Contact\\n      </TabButton>\\n      <hr />\\n      {tab === 'about' && <AboutTab />}\\n      {tab === 'posts' && <PostsTab />}\\n      {tab === 'contact' && <ContactTab />}\\n    </>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/TabButton.js active\",\"children\":\"import { useTransition } from 'react';\\n\\nexport default function TabButton({ children, isActive, onClick }) {\\n  const [isPending, startTransition] = useTransition();\\n  if (isActive) {\\n    return <b>{children}</b>\\n  }\\n  if (isPending) {\\n    return <b className=\\\"pending\\\">{children}</b>;\\n  }\\n  return (\\n    <button onClick={() => {\\n      startTransition(() => {\\n        onClick();\\n      });\\n    }}>\\n      {children}\\n    </button>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/AboutTab.js\",\"children\":\"export default function AboutTab() {\\n  return (\\n    <p>Welcome to my profile!</p>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/PostsTab.js\",\"children\":\"import { memo } from 'react';\\n\\nconst PostsTab = memo(function PostsTab() {\\n  // 打印一次。真正变慢的地方在 SlowPost 内。\\n  console.log('[ARTIFICIALLY SLOW] Rendering 500 <SlowPost />');\\n\\n  let items = [];\\n  for (let i = 0; i < 500; i++) {\\n    items.push(<SlowPost key={i} index={i} />);\\n  }\\n  return (\\n    <ul className=\\\"items\\\">\\n      {items}\\n    </ul>\\n  );\\n});\\n\\nfunction SlowPost({ index }) {\\n  let startTime = performance.now();\\n  while (performance.now() - startTime < 1) {\\n    // 每个 item 都等待 1 毫秒以模拟极慢的代码。\\n  }\\n\\n  return (\\n    <li className=\\\"item\\\">\\n      Post #{index + 1}\\n    </li>\\n  );\\n}\\n\\nexport default PostsTab;\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/ContactTab.js\",\"children\":\"export default function ContactTab() {\\n  return (\\n    <>\\n      <p>\\n        You can find me online here:\\n      </p>\\n      <ul>\\n        <li>admin@mysite.com</li>\\n        <li>+123456789</li>\\n      </ul>\\n    </>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"button { margin-right: 10px }\\nb { display: inline-block; margin-right: 10px; }\\n.pending { color: #777; }\\n\"}]}]]}],[\"$r\",\"MaxWidth\",\"100\",{\"children\":[\"\\n\",[\"$r\",\"hr\",null,{}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"preventing-unwanted-loading-indicators\",\"children\":\"避免不必要的加载指示器 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在这个例子中，\",[\"$r\",\"code\",null,{\"children\":\"PostsTab\"}],\" 组件从启用了 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/Suspense\",\"children\":\"Suspense\"}],\" 的数据源中获取了一些数据。当你点击“Posts”选项卡时，\",[\"$r\",\"code\",null,{\"children\":\"PostsTab\"}],\" 组件将 \",[\"$r\",\"strong\",null,{\"children\":\"挂起\"}],\"，导致最近的加载中的后备方案出现：\"]}],\"\\n\"]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"import { Suspense, useState } from 'react';\\nimport TabButton from './TabButton.js';\\nimport AboutTab from './AboutTab.js';\\nimport PostsTab from './PostsTab.js';\\nimport ContactTab from './ContactTab.js';\\n\\nexport default function TabContainer() {\\n  const [tab, setTab] = useState('about');\\n  return (\\n    <Suspense fallback={<h1>🌀 Loading...</h1>}>\\n      <TabButton\\n        isActive={tab === 'about'}\\n        onClick={() => setTab('about')}\\n      >\\n        About\\n      </TabButton>\\n      <TabButton\\n        isActive={tab === 'posts'}\\n        onClick={() => setTab('posts')}\\n      >\\n        Posts\\n      </TabButton>\\n      <TabButton\\n        isActive={tab === 'contact'}\\n        onClick={() => setTab('contact')}\\n      >\\n        Contact\\n      </TabButton>\\n      <hr />\\n      {tab === 'about' && <AboutTab />}\\n      {tab === 'posts' && <PostsTab />}\\n      {tab === 'contact' && <ContactTab />}\\n    </Suspense>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/TabButton.js\",\"children\":\"export default function TabButton({ children, isActive, onClick }) {\\n  if (isActive) {\\n    return <b>{children}</b>\\n  }\\n  return (\\n    <button onClick={() => {\\n      onClick();\\n    }}>\\n      {children}\\n    </button>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/AboutTab.js hidden\",\"children\":\"export default function AboutTab() {\\n  return (\\n    <p>Welcome to my profile!</p>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/PostsTab.js hidden\",\"children\":\"import { fetchData } from './data.js';\\n\\n// 注意：此组件使用了实验性 API 编写\\n// 这在 React 稳定版本中无法访问\\n\\n// 在实际的例子中，试试\\n// 像 Relay 或 Next.js 一样集成了 Suspense 的框架。\\n\\nfunction PostsTab() {\\n  const posts = use(fetchData('/posts'));\\n  return (\\n    <ul className=\\\"items\\\">\\n      {posts.map(post =>\\n        <Post key={post.id} title={post.title} />\\n      )}\\n    </ul>\\n  );\\n}\\n\\nfunction Post({ title }) {\\n  return (\\n    <li className=\\\"item\\\">\\n      {title}\\n    </li>\\n  );\\n}\\n\\nexport default PostsTab;\\n\\n// 这是一个解决演示运行问题的临时方法。\\n// TODO: 当 bug 修复后使用真实的实现替代此处。\\nfunction use(promise) {\\n  if (promise.status === 'fulfilled') {\\n    return promise.value;\\n  } else if (promise.status === 'rejected') {\\n    throw promise.reason;\\n  } else if (promise.status === 'pending') {\\n    throw promise;\\n  } else {\\n    promise.status = 'pending';\\n    promise.then(\\n      result => {\\n        promise.status = 'fulfilled';\\n        promise.value = result;\\n      },\\n      reason => {\\n        promise.status = 'rejected';\\n        promise.reason = reason;\\n      },\\n    );\\n    throw promise;\\n  }\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/ContactTab.js hidden\",\"children\":\"export default function ContactTab() {\\n  return (\\n    <>\\n      <p>\\n        You can find me online here:\\n      </p>\\n      <ul>\\n        <li>admin@mysite.com</li>\\n        <li>+123456789</li>\\n      </ul>\\n    </>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/data.js hidden\",\"children\":\"// 注意：数据获取的方式取决于\\n// 与 Suspense 一同使用的框架\\n// 通常缓存逻辑是由框架内部处理的。\\n\\nlet cache = new Map();\\n\\nexport function fetchData(url) {\\n  if (!cache.has(url)) {\\n    cache.set(url, getData(url));\\n  }\\n  return cache.get(url);\\n}\\n\\nasync function getData(url) {\\n  if (url.startsWith('/posts')) {\\n    return await getPosts();\\n  } else {\\n    throw Error('Not implemented');\\n  }\\n}\\n\\nasync function getPosts() {\\n  // Add a fake delay to make waiting noticeable.\\n  await new Promise(resolve => {\\n    setTimeout(resolve, 1000);\\n  });\\n  let posts = [];\\n  for (let i = 0; i < 500; i++) {\\n    posts.push({\\n      id: i,\\n      title: 'Post #' + (i + 1)\\n    });\\n  }\\n  return posts;\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"button { margin-right: 10px }\\nb { display: inline-block; margin-right: 10px; }\\n.pending { color: #777; }\\n\"}]}]]}],[\"$r\",\"MaxWidth\",\"106\",{\"children\":[\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"隐藏整个选项卡容器以显示加载指示符会导致用户体验不连贯。如果你将 \",[\"$r\",\"code\",null,{\"children\":\"useTransition\"}],\" 添加到 \",[\"$r\",\"code\",null,{\"children\":\"TabButton\"}],\" 中，你可以改为在选项卡按钮中指示待处理状态。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"请注意，现在点击“帖子”不再用一个旋转器替换整个选项卡容器：\"}],\"\\n\"]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"import { Suspense, useState } from 'react';\\nimport TabButton from './TabButton.js';\\nimport AboutTab from './AboutTab.js';\\nimport PostsTab from './PostsTab.js';\\nimport ContactTab from './ContactTab.js';\\n\\nexport default function TabContainer() {\\n  const [tab, setTab] = useState('about');\\n  return (\\n    <Suspense fallback={<h1>🌀 Loading...</h1>}>\\n      <TabButton\\n        isActive={tab === 'about'}\\n        onClick={() => setTab('about')}\\n      >\\n        About\\n      </TabButton>\\n      <TabButton\\n        isActive={tab === 'posts'}\\n        onClick={() => setTab('posts')}\\n      >\\n        Posts\\n      </TabButton>\\n      <TabButton\\n        isActive={tab === 'contact'}\\n        onClick={() => setTab('contact')}\\n      >\\n        Contact\\n      </TabButton>\\n      <hr />\\n      {tab === 'about' && <AboutTab />}\\n      {tab === 'posts' && <PostsTab />}\\n      {tab === 'contact' && <ContactTab />}\\n    </Suspense>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/TabButton.js active\",\"children\":\"import { useTransition } from 'react';\\n\\nexport default function TabButton({ children, isActive, onClick }) {\\n  const [isPending, startTransition] = useTransition();\\n  if (isActive) {\\n    return <b>{children}</b>\\n  }\\n  if (isPending) {\\n    return <b className=\\\"pending\\\">{children}</b>;\\n  }\\n  return (\\n    <button onClick={() => {\\n      startTransition(() => {\\n        onClick();\\n      });\\n    }}>\\n      {children}\\n    </button>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/AboutTab.js hidden\",\"children\":\"export default function AboutTab() {\\n  return (\\n    <p>Welcome to my profile!</p>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/PostsTab.js hidden\",\"children\":\"import { fetchData } from './data.js';\\n\\n// 注意：此组件使用了实验性 API 编写\\n// 这在 React 稳定版本中无法访问\\n\\n// 在实际的例子中，试试\\n// 像 Relay 或 Next.js 一样集成了 Suspense 的框架。\\n\\nfunction PostsTab() {\\n  const posts = use(fetchData('/posts'));\\n  return (\\n    <ul className=\\\"items\\\">\\n      {posts.map(post =>\\n        <Post key={post.id} title={post.title} />\\n      )}\\n    </ul>\\n  );\\n}\\n\\nfunction Post({ title }) {\\n  return (\\n    <li className=\\\"item\\\">\\n      {title}\\n    </li>\\n  );\\n}\\n\\nexport default PostsTab;\\n\\n// 这是一个解决演示运行问题的临时方法。\\n// TODO: 当 bug 修复后使用真实的实现替代此处。\\nfunction use(promise) {\\n  if (promise.status === 'fulfilled') {\\n    return promise.value;\\n  } else if (promise.status === 'rejected') {\\n    throw promise.reason;\\n  } else if (promise.status === 'pending') {\\n    throw promise;\\n  } else {\\n    promise.status = 'pending';\\n    promise.then(\\n      result => {\\n        promise.status = 'fulfilled';\\n        promise.value = result;\\n      },\\n      reason => {\\n        promise.status = 'rejected';\\n        promise.reason = reason;\\n      },\\n    );\\n    throw promise;\\n  }\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/ContactTab.js hidden\",\"children\":\"export default function ContactTab() {\\n  return (\\n    <>\\n      <p>\\n        You can find me online here:\\n      </p>\\n      <ul>\\n        <li>admin@mysite.com</li>\\n        <li>+123456789</li>\\n      </ul>\\n    </>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/data.js hidden\",\"children\":\"// 注意：数据获取的方式取决于\\n// 取决于与 Suspense 一同使用的框架\\n// 通常，缓存逻辑会嵌入在框架内部。\\n\\nlet cache = new Map();\\n\\nexport function fetchData(url) {\\n  if (!cache.has(url)) {\\n    cache.set(url, getData(url));\\n  }\\n  return cache.get(url);\\n}\\n\\nasync function getData(url) {\\n  if (url.startsWith('/posts')) {\\n    return await getPosts();\\n  } else {\\n    throw Error('Not implemented');\\n  }\\n}\\n\\nasync function getPosts() {\\n  // Add a fake delay to make waiting noticeable.\\n  await new Promise(resolve => {\\n    setTimeout(resolve, 1000);\\n  });\\n  let posts = [];\\n  for (let i = 0; i < 500; i++) {\\n    posts.push({\\n      id: i,\\n      title: 'Post #' + (i + 1)\\n    });\\n  }\\n  return posts;\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"button { margin-right: 10px }\\nb { display: inline-block; margin-right: 10px; }\\n.pending { color: #777; }\\n\"}]}]]}],[\"$r\",\"MaxWidth\",\"126\",{\"children\":[\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"a\",null,{\"href\":\"/reference/react/Suspense#preventing-already-revealed-content-from-hiding\",\"children\":\"了解有关在Suspense中使用转换的更多信息\"}],\"。\"]}],\"\\n\",[\"$r\",\"Note\",null,{\"children\":[\"$r\",\"p\",null,{\"children\":[\"转换效果只会“等待”足够长的时间来避免隐藏 \",[\"$r\",\"strong\",null,{\"children\":\"已经显示\"}],\" 的内容（例如选项卡容器）。如果“帖子”选项卡具有一个\",[\"$r\",\"a\",null,{\"href\":\"/reference/react/Suspense#revealing-nested-content-as-it-loads\",\"children\":[\"嵌套 \",[\"$r\",\"code\",null,{\"children\":\"<Suspense>\"}],\" 边界\"]}],\"，转换效果将不会“等待”它。\"]}]}],\"\\n\",[\"$r\",\"hr\",null,{}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"building-a-suspense-enabled-router\",\"children\":\"构建一个Suspense-enabled 的路由 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"如果你正在构建一个 React 框架或路由，我们建议将页面导航标记为转换效果。\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{3,6,8}\",\"children\":\"function Router() {\\n  const [page, setPage] = useState('/');\\n  const [isPending, startTransition] = useTransition();\\n\\n  function navigate(url) {\\n    startTransition(() => {\\n      setPage(url);\\n    });\\n  }\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"这么做有两个好处：\"}],\"\\n\",[\"$r\",\"ul\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"a\",null,{\"href\":\"#marking-a-state-update-as-a-non-blocking-transition\",\"children\":\"转换效果是可中断的\"}],\"，这样用户可以在等待重新渲染完成之前点击其他地方。\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"a\",null,{\"href\":\"#preventing-unwanted-loading-indicators\",\"children\":\"转换效果可以防止不必要的加载指示符\"}],\"，这样用户就可以避免在导航时产生不协调的跳转。\"]}],\"\\n\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"下面是一个简单的使用转换效果进行页面导航的路由器示例：\"}],\"\\n\"]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-json\",\"meta\":\"package.json hidden\",\"children\":\"{\\n  \\\"dependencies\\\": {\\n    \\\"react\\\": \\\"experimental\\\",\\n    \\\"react-dom\\\": \\\"experimental\\\"\\n  },\\n  \\\"scripts\\\": {\\n    \\\"start\\\": \\\"react-scripts start\\\",\\n    \\\"build\\\": \\\"react-scripts build\\\",\\n    \\\"test\\\": \\\"react-scripts test --env=jsdom\\\",\\n    \\\"eject\\\": \\\"react-scripts eject\\\"\\n  }\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/App.js\",\"children\":\"import { Suspense, useState, useTransition } from 'react';\\nimport IndexPage from './IndexPage.js';\\nimport ArtistPage from './ArtistPage.js';\\nimport Layout from './Layout.js';\\n\\nexport default function App() {\\n  return (\\n    <Suspense fallback={<BigSpinner />}>\\n      <Router />\\n    </Suspense>\\n  );\\n}\\n\\nfunction Router() {\\n  const [page, setPage] = useState('/');\\n  const [isPending, startTransition] = useTransition();\\n\\n  function navigate(url) {\\n    startTransition(() => {\\n      setPage(url);\\n    });\\n  }\\n\\n  let content;\\n  if (page === '/') {\\n    content = (\\n      <IndexPage navigate={navigate} />\\n    );\\n  } else if (page === '/the-beatles') {\\n    content = (\\n      <ArtistPage\\n        artist={{\\n          id: 'the-beatles',\\n          name: 'The Beatles',\\n        }}\\n      />\\n    );\\n  }\\n  return (\\n    <Layout isPending={isPending}>\\n      {content}\\n    </Layout>\\n  );\\n}\\n\\nfunction BigSpinner() {\\n  return <h2>🌀 Loading...</h2>;\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/Layout.js\",\"children\":\"export default function Layout({ children, isPending }) {\\n  return (\\n    <div className=\\\"layout\\\">\\n      <section className=\\\"header\\\" style={{\\n        opacity: isPending ? 0.7 : 1\\n      }}>\\n        Music Browser\\n      </section>\\n      <main>\\n        {children}\\n      </main>\\n    </div>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/IndexPage.js\",\"children\":\"export default function IndexPage({ navigate }) {\\n  return (\\n    <button onClick={() => navigate('/the-beatles')}>\\n      Open The Beatles artist page\\n    </button>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/ArtistPage.js\",\"children\":\"import { Suspense } from 'react';\\nimport Albums from './Albums.js';\\nimport Biography from './Biography.js';\\nimport Panel from './Panel.js';\\n\\nexport default function ArtistPage({ artist }) {\\n  return (\\n    <>\\n      <h1>{artist.name}</h1>\\n      <Biography artistId={artist.id} />\\n      <Suspense fallback={<AlbumsGlimmer />}>\\n        <Panel>\\n          <Albums artistId={artist.id} />\\n        </Panel>\\n      </Suspense>\\n    </>\\n  );\\n}\\n\\nfunction AlbumsGlimmer() {\\n  return (\\n    <div className=\\\"glimmer-panel\\\">\\n      <div className=\\\"glimmer-line\\\" />\\n      <div className=\\\"glimmer-line\\\" />\\n      <div className=\\\"glimmer-line\\\" />\\n    </div>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/Albums.js hidden\",\"children\":\"import { fetchData } from './data.js';\\n\\n// 注意：此组件使用了实验性 API 编写\\n// 这在 React 稳定版本中无法访问\\n\\n// 在实际的例子中，试试\\n// 像 Relay 或 Next.js 一样集成了 Suspense 的框架。\\n\\nexport default function Albums({ artistId }) {\\n  const albums = use(fetchData(`/${artistId}/albums`));\\n  return (\\n    <ul>\\n      {albums.map(album => (\\n        <li key={album.id}>\\n          {album.title} ({album.year})\\n        </li>\\n      ))}\\n    </ul>\\n  );\\n}\\n\\n// 这是一个解决演示运行问题的临时方法。\\n// TODO: 当 bug 修复后使用真实的实现替代此处。\\nfunction use(promise) {\\n  if (promise.status === 'fulfilled') {\\n    return promise.value;\\n  } else if (promise.status === 'rejected') {\\n    throw promise.reason;\\n  } else if (promise.status === 'pending') {\\n    throw promise;\\n  } else {\\n    promise.status = 'pending';\\n    promise.then(\\n      result => {\\n        promise.status = 'fulfilled';\\n        promise.value = result;\\n      },\\n      reason => {\\n        promise.status = 'rejected';\\n        promise.reason = reason;\\n      },\\n    );\\n    throw promise;\\n  }\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/Biography.js hidden\",\"children\":\"import { fetchData } from './data.js';\\n\\n// 注意：此组件使用了实验性 API 编写\\n// 这在 React 稳定版本中无法访问\\n\\n// 在实际的例子中，试试\\n// 像 Relay 或 Next.js 一样集成了 Suspense 的框架。\\n\\nexport default function Biography({ artistId }) {\\n  const bio = use(fetchData(`/${artistId}/bio`));\\n  return (\\n    <section>\\n      <p className=\\\"bio\\\">{bio}</p>\\n    </section>\\n  );\\n}\\n\\n// 这是一个解决演示运行问题的临时方法。\\n// TODO: 当 bug 修复后使用真实的实现替代此处。\\nfunction use(promise) {\\n  if (promise.status === 'fulfilled') {\\n    return promise.value;\\n  } else if (promise.status === 'rejected') {\\n    throw promise.reason;\\n  } else if (promise.status === 'pending') {\\n    throw promise;\\n  } else {\\n    promise.status = 'pending';\\n    promise.then(\\n      result => {\\n        promise.status = 'fulfilled';\\n        promise.value = result;\\n      },\\n      reason => {\\n        promise.status = 'rejected';\\n        promise.reason = reason;\\n      },\\n    );\\n    throw promise;\\n  }\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/Panel.js hidden\",\"children\":\"export default function Panel({ children }) {\\n  return (\\n    <section className=\\\"panel\\\">\\n      {children}\\n    </section>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/data.js hidden\",\"children\":\"// 注意：数据获取的方式取决于\\n// 取决于与 Suspense 一同使用的框架\\n// 通常缓存逻辑是由框架内部处理的。\\n\\nlet cache = new Map();\\n\\nexport function fetchData(url) {\\n  if (!cache.has(url)) {\\n    cache.set(url, getData(url));\\n  }\\n  return cache.get(url);\\n}\\n\\nasync function getData(url) {\\n  if (url === '/the-beatles/albums') {\\n    return await getAlbums();\\n  } else if (url === '/the-beatles/bio') {\\n    return await getBio();\\n  } else {\\n    throw Error('Not implemented');\\n  }\\n}\\n\\nasync function getBio() {\\n  // Add a fake delay to make waiting noticeable.\\n  await new Promise(resolve => {\\n    setTimeout(resolve, 500);\\n  });\\n\\n  return `The Beatles were an English rock band,\\n    formed in Liverpool in 1960, that comprised\\n    John Lennon, Paul McCartney, George Harrison\\n    and Ringo Starr.`;\\n}\\n\\nasync function getAlbums() {\\n  // Add a fake delay to make waiting noticeable.\\n  await new Promise(resolve => {\\n    setTimeout(resolve, 3000);\\n  });\\n\\n  return [{\\n    id: 13,\\n    title: 'Let It Be',\\n    year: 1970\\n  }, {\\n    id: 12,\\n    title: 'Abbey Road',\\n    year: 1969\\n  }, {\\n    id: 11,\\n    title: 'Yellow Submarine',\\n    year: 1969\\n  }, {\\n    id: 10,\\n    title: 'The Beatles',\\n    year: 1968\\n  }, {\\n    id: 9,\\n    title: 'Magical Mystery Tour',\\n    year: 1967\\n  }, {\\n    id: 8,\\n    title: 'Sgt. Pepper\\\\'s Lonely Hearts Club Band',\\n    year: 1967\\n  }, {\\n    id: 7,\\n    title: 'Revolver',\\n    year: 1966\\n  }, {\\n    id: 6,\\n    title: 'Rubber Soul',\\n    year: 1965\\n  }, {\\n    id: 5,\\n    title: 'Help!',\\n    year: 1965\\n  }, {\\n    id: 4,\\n    title: 'Beatles For Sale',\\n    year: 1964\\n  }, {\\n    id: 3,\\n    title: 'A Hard Day\\\\'s Night',\\n    year: 1964\\n  }, {\\n    id: 2,\\n    title: 'With The Beatles',\\n    year: 1963\\n  }, {\\n    id: 1,\\n    title: 'Please Please Me',\\n    year: 1963\\n  }];\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"main {\\n  min-height: 200px;\\n  padding: 10px;\\n}\\n\\n.layout {\\n  border: 1px solid black;\\n}\\n\\n.header {\\n  background: #222;\\n  padding: 10px;\\n  text-align: center;\\n  color: white;\\n}\\n\\n.bio { font-style: italic; }\\n\\n.panel {\\n  border: 1px solid #aaa;\\n  border-radius: 6px;\\n  margin-top: 20px;\\n  padding: 10px;\\n}\\n\\n.glimmer-panel {\\n  border: 1px dashed #aaa;\\n  background: linear-gradient(90deg, rgba(221,221,221,1) 0%, rgba(255,255,255,1) 100%);\\n  border-radius: 6px;\\n  margin-top: 20px;\\n  padding: 10px;\\n}\\n\\n.glimmer-line {\\n  display: block;\\n  width: 60%;\\n  height: 20px;\\n  margin: 10px;\\n  border-radius: 4px;\\n  background: #f0f0f0;\\n}\\n\"}]}]]}],[\"$r\",\"MaxWidth\",\"138\",{\"children\":[\"\\n\",[\"$r\",\"Note\",null,{\"children\":[\"$r\",\"p\",null,{\"children\":[\"启用 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/Suspense\",\"children\":\"Suspense\"}],\" 的路由默认情况下会将页面导航更新包装为 transition。\"]}]}],\"\\n\",[\"$r\",\"hr\",null,{}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"displaying-an-error-to-users-with-error-boundary\",\"children\":\"Displaying an error to users with an error boundary \"}],\"\\n\",[\"$r\",\"Canary\",null,{\"children\":[\"$r\",\"p\",null,{\"children\":[\"Error Boundary for useTransition is currently only available in React’s canary and experimental channels. Learn more about \",[\"$r\",\"a\",null,{\"href\":\"/community/versioning-policy#all-release-channels\",\"children\":\"React’s release channels here\"}],\".\"]}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"If a function passed to \",[\"$r\",\"code\",null,{\"children\":\"startTransition\"}],\" throws an error, you can display an error to your user with an \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/Component#catching-rendering-errors-with-an-error-boundary\",\"children\":\"error boundary\"}],\". To use an error boundary, wrap the component where you are calling the \",[\"$r\",\"code\",null,{\"children\":\"useTransition\"}],\" in an error boundary. Once the function passed to \",[\"$r\",\"code\",null,{\"children\":\"startTransition\"}],\" errors, the fallback for the error boundary will be displayed.\"]}],\"\\n\"]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/AddCommentContainer.js active\",\"children\":\"import { useTransition } from \\\"react\\\";\\nimport { ErrorBoundary } from \\\"react-error-boundary\\\";\\n\\nexport function AddCommentContainer() {\\n  return (\\n    <ErrorBoundary fallback={<p>⚠️Something went wrong</p>}>\\n      <AddCommentButton />\\n    </ErrorBoundary>\\n  );\\n}\\n\\nfunction addComment(comment) {\\n  // For demonstration purposes to show Error Boundary\\n  if (comment == null) {\\n    throw new Error(\\\"Example Error: An error thrown to trigger error boundary\\\");\\n  }\\n}\\n\\nfunction AddCommentButton() {\\n  const [pending, startTransition] = useTransition();\\n\\n  return (\\n    <button\\n      disabled={pending}\\n      onClick={() => {\\n        startTransition(() => {\\n          // Intentionally not passing a comment\\n          // so error gets thrown\\n          addComment();\\n        });\\n      }}\\n    >\\n      Add comment\\n    </button>\\n  );\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/App.js hidden\",\"children\":\"import { AddCommentContainer } from \\\"./AddCommentContainer.js\\\";\\n\\nexport default function App() {\\n  return <AddCommentContainer />;\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/index.js hidden\",\"children\":\"// TODO: update to import from stable\\n// react instead of canary once the `use`\\n// Hook is in a stable release of React\\nimport React, { StrictMode } from 'react';\\nimport { createRoot } from 'react-dom/client';\\nimport './styles.css';\\n\\n// TODO: update this example to use\\n// the Codesandbox Server Component\\n// demo environment once it is created\\nimport App from './App';\\n\\nconst root = createRoot(document.getElementById('root'));\\nroot.render(\\n  <StrictMode>\\n    <App />\\n  </StrictMode>\\n);\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-json\",\"meta\":\"package.json hidden\",\"children\":\"{\\n  \\\"dependencies\\\": {\\n    \\\"react\\\": \\\"canary\\\",\\n    \\\"react-dom\\\": \\\"canary\\\",\\n    \\\"react-scripts\\\": \\\"^5.0.0\\\",\\n    \\\"react-error-boundary\\\": \\\"4.0.3\\\"\\n  },\\n  \\\"main\\\": \\\"/index.js\\\"\\n}\\n\"}]}]]}],[\"$r\",\"MaxWidth\",\"last\",{\"children\":[\"\\n\",[\"$r\",\"hr\",null,{}],\"\\n\",[\"$r\",\"h2\",null,{\"id\":\"troubleshooting\",\"children\":\"Troubleshooting \"}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"updating-an-input-in-a-transition-doesnt-work\",\"children\":\"在 transition 中无法更新输入框内容 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"不应将控制输入框的状态变量标记为 transition：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{4,10}\",\"children\":\"const [text, setText] = useState('');\\n// ...\\nfunction handleChange(e) {\\n  // ❌ 不应将受控输入框的状态变量标记为 transition\\n  startTransition(() => {\\n    setText(e.target.value);\\n  });\\n}\\n// ...\\nreturn <input value={text} onChange={handleChange} />;\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"这是因为 transition 是非阻塞的，但是在响应更改事件时更新输入应该是同步的。如果想在输入时运行一个 transition，那么有两种做法：\"}],\"\\n\",[\"$r\",\"ol\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":\"声明两个独立的状态变量：一个用于输入状态（它总是同步更新），另一个用于在 transition 中更新。这样，便可以使用同步状态控制输入，并将用于 transition 的状态变量（它将“滞后”于输入）传递给其余的渲染逻辑。\"}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"或者使用一个状态变量，并添加 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/useDeferredValue\",\"children\":[\"$r\",\"code\",null,{\"children\":\"useDeferredValue\"}]}],\"，它将“滞后”于实际值，并自动触发非阻塞的重新渲染以“追赶”新值。\"]}],\"\\n\"]}],\"\\n\",[\"$r\",\"hr\",null,{}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"react-doesnt-treat-my-state-update-as-a-transition\",\"children\":\"React 没有将状态更新视为 transition \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"当在 transition 中包装状态更新时，请确保它发生在 \",[\"$r\",\"code\",null,{\"children\":\"startTransition\"}],\" 调用期间：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"startTransition(() => {\\n  // ✅ 在调用 startTransition 中更新状态\\n  setPage('/about');\\n});\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"传递给 \",[\"$r\",\"code\",null,{\"children\":\"startTransition\"}],\" 的函数必须是同步的。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"你不能像这样将更新标记为 transition：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"startTransition(() => {\\n  // ❌ 在调用 startTransition 后更新状态\\n  setTimeout(() => {\\n    setPage('/about');\\n  }, 1000);\\n});\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"相反，你可以这样做：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"setTimeout(() => {\\n  startTransition(() => {\\n    // ✅ 在调用 startTransition 中更新状态\\n    setPage('/about');\\n  });\\n}, 1000);\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"类似地，你不能像这样将更新标记为 transition：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"startTransition(async () => {\\n  await someAsyncFunction();\\n  // ❌ 在调用 startTransition 后更新状态\\n  setPage('/about');\\n});\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"然而，使用以下方法可以正常工作：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"await someAsyncFunction();\\nstartTransition(() => {\\n  // ✅ 在调用 startTransition 中更新状态\\n  setPage('/about');\\n});\\n\"}]}],\"\\n\",[\"$r\",\"hr\",null,{}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"i-want-to-call-usetransition-from-outside-a-component\",\"children\":[\"我想在组件外部调用 \",[\"$r\",\"code\",null,{\"children\":\"useTransition\"}],\" \"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"useTransition\"}],\" 是一个 Hook，因此不能在组件外部调用。请使用独立的 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/startTransition\",\"children\":[\"$r\",\"code\",null,{\"children\":\"startTransition\"}]}],\" 方法。它们的工作方式相同，但不提供 \",[\"$r\",\"code\",null,{\"children\":\"isPending\"}],\" 标记。\"]}],\"\\n\",[\"$r\",\"hr\",null,{}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"the-function-i-pass-to-starttransition-executes-immediately\",\"children\":[\"我传递给 \",[\"$r\",\"code\",null,{\"children\":\"startTransition\"}],\" 的函数会立即执行 \"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"如果你运行这段代码，它将会打印 1, 2, 3：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{1,3,6}\",\"children\":\"console.log(1);\\nstartTransition(() => {\\n  console.log(2);\\n  setPage('/about');\\n});\\nconsole.log(3);\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"strong\",null,{\"children\":\"期望打印 1, 2, 3\"}],\"。传递给 \",[\"$r\",\"code\",null,{\"children\":\"startTransition\"}],\" 的函数不会被延迟执行。与浏览器的 \",[\"$r\",\"code\",null,{\"children\":\"setTimeout\"}],\" 不同，它不会延迟执行回调。React 会立即执行你的函数，但是在它运行的同时安排的任何状态更新都被标记为 transition。你可以将其想象为以下方式：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"// React 运行的简易版本\\n\\nlet isInsideTransition = false;\\n\\nfunction startTransition(scope) {\\n  isInsideTransition = true;\\n  scope();\\n  isInsideTransition = false;\\n}\\n\\nfunction setState() {\\n  if (isInsideTransition) {\\n    // ……安排 transition 状态更新……\\n  } else {\\n    // ……安排紧急状态更新……\\n  }\\n}\\n\"}]}]]}]]","meta":{"title":"useTransition"}},"__N_SSG":true}